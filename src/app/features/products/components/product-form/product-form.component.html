<form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="product-form">
  <div class="form-group">
    <label for="title" class="form-label">Título</label>
    <input
      id="title"
      type="text"
      formControlName="title"
      placeholder="Ingresa el título del producto"
      [class.form-input-error]="isFieldInvalid('title')"
      class="form-input"
    />
    @if (isFieldInvalid('title')) {
      <span class="error-message">{{ getFieldError('title') }}</span>
    }
  </div>

  <div class="form-group">
    <label for="price" class="form-label">Precio</label>
    <input
      id="price"
      type="number"
      formControlName="price"
      min="0"
      step="0.01"
      placeholder="0.00"
      [class.form-input-error]="isFieldInvalid('price')"
      class="form-input"
    />
    @if (isFieldInvalid('price')) {
      <span class="error-message">{{ getFieldError('price') }}</span>
    }
  </div>

  <div class="form-group">
    <label for="description" class="form-label">Descripción</label>
    <textarea
      id="description"
      formControlName="description"
      rows="4"
      placeholder="Ingresa la descripción del producto"
      [class.form-input-error]="isFieldInvalid('description')"
      class="form-textarea"
    ></textarea>
    @if (isFieldInvalid('description')) {
      <span class="error-message">{{ getFieldError('description') }}</span>
    }
  </div>

  <div class="form-group">
    <label for="category" class="form-label">Categoría</label>
    <select
      id="category"
      formControlName="category"
      [class.form-input-error]="isFieldInvalid('category')"
      class="form-input"
    >
      <option value="">Selecciona una categoría</option>
      @for (category of categories; track category) {
        <option [value]="category">{{ category.charAt(0).toUpperCase() + category.slice(1) }}</option>
      }
    </select>
    @if (isFieldInvalid('category')) {
      <span class="error-message">{{ getFieldError('category') }}</span>
    }
  </div>

  <div class="form-group">
    <label for="image" class="form-label">URL de Imagen (Opcional)</label>
    <input
      id="image"
      type="url"
      formControlName="image"
      placeholder="https://ejemplo.com/imagen.jpg (opcional)"
      [class.form-input-error]="isFieldInvalid('image')"
      class="form-input"
    />
    @if (isFieldInvalid('image')) {
      <span class="error-message">{{ getFieldError('image') }}</span>
    }

    <div class="mt-3">
      <input
        #fileInput
        type="file"
        accept="image/*"
        (change)="onFileSelected($event)"
        class="hidden"
      />
      <button
        type="button"
        (click)="triggerFileInput()"
        class="px-4 py-2 bg-gradient-to-r from-primary to-primary/90 text-primary-foreground rounded-xl hover:from-primary/90 hover:to-primary/80 transition-all font-semibold text-sm shadow-sm hover:shadow-md transform hover:scale-[1.02] active:scale-[0.98] cursor-pointer flex items-center gap-2"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
        </svg>
        <span>Subir imagen</span>
      </button>
      <p class="mt-2 text-xs text-muted-foreground">Formatos: JPG, PNG, GIF. Máximo 5MB</p>
    </div>

    @if (imagePreview()) {
      <div class="mt-4 relative">
        <div class="relative inline-block">
          <img
            [src]="imagePreview()!"
            alt="Preview"
            class="max-w-full h-auto max-h-64 rounded-lg border border-border shadow-sm"
            (error)="imagePreview.set(null)"
          />
          <button
            type="button"
            (click)="removeImage()"
            class="absolute top-2 right-2 p-1.5 bg-destructive text-destructive-foreground rounded-full hover:bg-destructive/90 transition-all shadow-md cursor-pointer"
            aria-label="Eliminar imagen"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>
    }
  </div>

  <div class="form-actions">
    <button
      type="button"
      (click)="onCancel.emit()"
      class="btn btn-secondary"
    >
      Cancelar
    </button>
    <button
      type="submit"
      class="btn btn-primary"
      [disabled]="productForm.invalid || loading"
    >
      @if (loading) {
        <span class="flex items-center gap-2">
          <svg class="w-4 h-4 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg>
          {{ product ? 'Actualizando...' : 'Creando...' }}
        </span>
      } @else {
        {{ product ? 'Actualizar' : 'Crear' }}
      }
    </button>
  </div>
</form>

